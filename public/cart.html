<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ˜Ÿèªè€…è³¼ç‰©è»Š âœ¦ Star Whisperer Cart</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&family=Noto+Sans+TC:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Noto Sans TC", "Inter", sans-serif;
        background: radial-gradient(circle at 50% 20%, #0a192f, #000814 90%);
        color: #ccd6f6;
        text-align: center;
        margin: 0;
        padding: 2rem;
      }

      h1 {
        color: #64ffda;
        text-shadow: 0 0 10px #64ffda;
        margin-bottom: 2rem;
      }

      table {
        width: 80%;
        margin: 2rem auto;
        border-collapse: collapse;
        background: rgba(13, 33, 58, 0.8);
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 15px rgba(100, 255, 218, 0.2);
      }

      th, td {
        padding: 1rem;
        border-bottom: 1px solid rgba(100, 255, 218, 0.2);
      }

      th {
        background: rgba(100, 255, 218, 0.2);
        color: #64ffda;
        font-weight: 700;
      }

      td {
        color: #ccd6f6;
      }

      .btn {
        display: inline-block;
        margin: 1rem;
        padding: 0.8rem 1.8rem;
        border: 2px solid #64ffda;
        color: #64ffda;
        background: transparent;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 700;
        transition: 0.3s;
      }

      .btn:hover {
        background: rgba(100, 255, 218, 0.1);
      }

      .empty {
        color: #999;
        font-style: italic;
        margin-top: 2rem;
      }

      footer {
        margin-top: 3rem;
        font-size: 0.9rem;
        color: rgba(204, 214, 246, 0.6);
      }

      .total {
        color: #ffd700;
        font-weight: bold;
        margin-top: 1rem;
      }
    </style>
  </head>

  <body>
    <h1>ğŸ›’ æ˜Ÿèªè€…è³¼ç‰©è»Š</h1>

    <table id="cart-table">
      <tr>
        <th>å•†å“åç¨±</th>
        <th>æ•¸é‡</th>
      </tr>
    </table>

    <p id="empty-msg" class="empty"></p>
    <p id="total" class="total"></p>

    <div>
      <button class="btn" onclick="goCheckout()">ğŸª™ å‰å¾€çµå¸³</button>
      <button class="btn" onclick="clearCart()">æ¸…ç©ºè³¼ç‰©è»Š âœ¦</button>
      <button class="btn" onclick="goLibrary()">è¿”å›å®‡å®™ä¹‹æ›¸</button>
      <button class="btn" onclick="logout()">ç™»å‡º</button>
    </div>

    <footer>Â© 2025 Star Whisperer | Voyage of the Star River</footer>

    <script>
      // === æ¨¡æ“¬å•†å“åƒ¹æ ¼ ===
      const productPrices = {
        "å¤ªé™½ç³»Tæ¤": 880,
        "åœŸæ˜Ÿç’°æ‰‹éŒ¶": 2280,
        "éŠ€æ²³ç³»æ‰˜ç‰¹åŒ…": 1080,
        "å½—æ˜Ÿé …éŠ": 680
      };

      // === è¼‰å…¥è³¼ç‰©è»Š ===
      function loadCart() {
        const cart = JSON.parse(localStorage.getItem("cart")) || {};
        const table = document.getElementById("cart-table");
        const msg = document.getElementById("empty-msg");
        const totalEl = document.getElementById("total");
        let total = 0;

        if (Object.keys(cart).length === 0) {
          msg.textContent = "ç›®å‰è³¼ç‰©è»Šæ˜¯ç©ºçš„ âœ¦";
          table.style.display = "none";
          totalEl.textContent = "";
          return;
        }

        msg.textContent = "";
        table.style.display = "table";

        let rows = "<tr><th>å•†å“åç¨±</th><th>æ•¸é‡</th></tr>";
        for (const [name, count] of Object.entries(cart)) {
          const price = productPrices[name] || 0;
          total += price * count;
          rows += `<tr><td>${name}</td><td>${count}</td></tr>`;
        }

        table.innerHTML = rows;
        totalEl.textContent = "åˆè¨ˆé‡‘é¡ï¼š" + total + " å…ƒ";
      }

      // === å‰å¾€çµå¸³ ===
      function goCheckout() {
        const cart = JSON.parse(localStorage.getItem("cart")) || {};
        if (Object.keys(cart).length === 0) {
          alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œè«‹å…ˆé¸æ“‡å•†å“ âœ¦");
          return;
        }
        window.location.href = "checkout.html";
      }

      // === æ¸…ç©ºè³¼ç‰©è»Š ===
      function clearCart() {
        localStorage.removeItem("cart");
        alert("è³¼ç‰©è»Šå·²æ¸…ç©º âœ¦");
        loadCart();
      }

      // === è¿”å›å®‡å®™ä¹‹æ›¸ ===
      function goLibrary() {
        window.location.href = "library.html";
      }

      // === ç™»å‡º ===
      async function logout() {
        await fetch("/logout", { method: "POST", credentials: "include" });
        alert("å·²ç™»å‡º âœ¦");
        localStorage.removeItem("cart");
        window.location.href = "index.html";
      }

      loadCart();
    </script>
  </body>
</html>
